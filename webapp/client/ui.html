<template name="appBody">
  <div class="container">
    {{>Template.dynamic template=content data=jobId}}
  </div>
</template>

<template name="pageNotFound">
  <div class="jumbotron" style="margin-top: 10px;">
    <h1>Page not found!</h1>
    <p>
      I wonder how you ended up here...
    </p>
  </div>
</template>

<template name="create">
  <h1>Create</h1>

  {{#autoForm id="create-job" collection=Jobs}}
    {{> afQuickField name="upstreamProteins" type="textarea" rows=5}}
    {{> afQuickField name="downstreamProteins" type="textarea" rows=5}}
    <button type="submit" class="btn btn-primary">Run</button>
  {{/autoForm}}
</template>

<template name="showResult">
  <h1>
    Result
    <a href={{pathFor "create"}} class="pull-right btn btn-default btn-lg">
      Create another
      {{! TODO: have they saved the URL?}}
    </a>
  </h1>
  {{#if Template.subscriptionsReady}}
    {{#with getJob}}
      {{#if compare status "done"}}
        {{> jobDoneResult}}
      {{else}}
        {{#if compare status "running"}}
          <div class="jumbotron">
            <h1>Running...</h1>
            <p>
              Your job is running and will be completed soon!
            </p>
          </div>
        {{else}}
          <div class="alert alert-danger" role="alert">
            <h4>Error running job</h4>
            <p>
              We've run into some trouble running your job. It's possible but
              we are performing maintenance on the site, so please try your
              job again in a couple minutes. If it still doesn't work, please
              let us know by clicking the button below.
            </p>
            <p>
              Error description: <code>{{error_description}}</code>
            </p>
            <p>
              The id of this job is <code>{{_id}}</code>. Please mention this
              id if you email us about this job.
            </p>
            <p>
              <a href="mailto:mokolodi1@gmail.com?Subject=Job%20error:%20{{_id}}"
                  type="button" class="btn btn-primary">
                Contact the developers
              </a>
            </p>
          </div>
        {{/if}}
      {{/if}}
    {{/with}}

    {{! This will be shown if the data has finished loading but there's no
        job that matches the query. This would imply the job _id in the URL
        is invalid}}
    {{#unless getJob}}
      <div class="alert alert-danger" role="alert">
        <h4>Invalid URL</h4>
        <p>
          You seem to have entered an invalid URL.
        </p>
        <p>
          If you believe you are seeing this this message in error, please
          contact the developers.
        </p>
        <p>
          <a href="mailto:mokolodi1@gmail.com?Subject=Invalid%20URL"
              type="button" class="btn btn-primary">
            Contact the developers
          </a>
        </p>
      </div>
    {{/unless}}
  {{else}}
    <div class="alert alert-info" role="alert">
      <h4>Loading...</h4>
      <p>
        The data will arrive soon!
      </p>
    </div>
  {{/if}}
</template>

<template name="jobDoneResult">
  <h3>Input</h3>
  <h4>Upstream proteins</h4>
  <div class="row">
    <div class="col-md-4 col-sm-8 col-xs-12">
      {{> listGenes upstreamProteins}}
    </div>
  </div>

  <h4>Downstream proteins</h4>
  <div class="row">
    <div class="col-md-4 col-sm-8 col-xs-12">
      {{> listGenes downstreamProteins}}
    </div>
  </div>

  <h3>pCHIP</h3>
  {{> pChipResult this}}

  <div class="alert alert-warning alert-dismissible" role="alert"
      style="display: inline-block; margin-top: 25px;">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <strong>Heads up!</strong>
    Be sure to save this page's URL if you'd like to access this result
    later.
  </div>
</template>

<template name="listGenes">
  <ul class="list-group">
    {{#each this}}
      <a href="http://www.genecards.org/cgi-bin/carddisp.pl?gene={{this}}"
          data-toggle="tooltip" title="View in GeneCards"
          class="list-group-item">
        {{this}}
      </a>
    {{/each}}
  </ul>
</template>

<template name="pChipResult">
  {{#with FS.GetFile "blobs" result.hallmarksBlobId}}
    <a href="{{this.url}}" target="_blank">
      <img src="{{this.url}}" alt="" style="width: 100%;">
    </a>
  {{/with}}
</template>
