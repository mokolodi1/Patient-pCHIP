<template name="appBody">
  <div class="container">
    <h1>
      pCHIPS
      <small>
        <u>P</u>atient
        <u>C</u>ancer
        <u>H</u>allmark
        <u>I</u>ntegrated
        <u>P</u>hospho
        <u>S</u>ignature
      </small>

      {{#unless isActiveRoute "create"}}
        <a href={{pathFor "create"}} class="pull-right btn btn-primary btn-lg">
          Run again
          {{! TODO: have they saved the URL?}}
        </a>
      {{/unless}}
    </h1>

    {{>Template.dynamic template=content data=jobId}}
  </div>
</template>

<template name="pageNotFound">
  <div class="jumbotron" style="margin-top: 10px;">
    <h1>Page not found!</h1>
    <p>
      I wonder how you ended up here...
    </p>
  </div>
</template>

<template name="create">
  {{#autoForm id="create-job" collection=Jobs}}
    <h4>Select scaffold network for patient subtype</h4>
    <p>
      scaffold select here
    </p>

  	<div class="row">
  		<div class="col-md-3">
  			<h4> Activated Kinases </h4>
  			<h6 style="color:#808080"> Examples: AKT1, PRKDC, CDK1... </h6>
      		{{> afQuickField name="kinases" type="textarea" rows=5 input-col-class="col-md-4"}}
  		</div>

  		<div class="col-md-3">
  			<h4> Mutated Genes </h4>
  			<h6 style="color:#808080"> Examples: TP53, APC, RB1... </h6>
      		{{> afQuickField name="mutations" type="textarea" rows=5 input-col-class="col-md-4"}}
  		</div>

  		<div class="col-md-3">
  			<h4> Copy Number / Amplifications </h4>
  			<h6 style="color:#808080"> Examples: AR, DNMT3A, MYC... </h6>
      		{{> afQuickField name="amps" type="textarea" rows=5 input-col-class="col-md-4"}}
  		</div>

  		<div class="col-md-3">
  			<h4> Copy Number / Deletions </h4>
  			<h6 style="color:#808080"> Examples: PHB, CHAF1A, NCOR1... </h6>
      		{{> afQuickField name="dels" type="textarea" rows=5 input-col-class="col-md-4"}}
  		</div>
  	</div>

  	<h4> Activated or Repressed Transcription Factors </h4>
  	<h6 style="color:#808080"> Examples: AR, SUV39H1, DNMT1... </h6>
    {{> afQuickField name="tfs" type="textarea" rows=5}}
    <button type="submit" class="btn btn-primary">Run</button>
  {{/autoForm}}
</template>

<template name="showResult">
  {{#if Template.subscriptionsReady}}
    {{#with getJob}}
      {{#if compare status "done"}}
        {{> jobDoneResult}}
      {{else}}
        {{#if compare status "running"}}
          <div class="jumbotron">
            <h1>Running...</h1>
            <p>
              Your job is running and will be completed soon!
            </p>
          </div>
        {{else}}
          <div class="alert alert-danger" role="alert">
            <h4>Error running job</h4>
            <p>
              We've run into some trouble running your job. It's possible but
              we are performing maintenance on the site, so please try your
              job again in a couple minutes. If it still doesn't work, please
              let us know by clicking the button below.
            </p>
            <p>
              Error description: <code>{{error_description}}</code>
            </p>
            <p>
              The id of this job is <code>{{_id}}</code>. Please mention this
              id if you email us about this job.
            </p>
            <p>
              <a href="mailto:mokolodi1@gmail.com?Subject=Job%20error:%20{{_id}}"
                  type="button" class="btn btn-primary">
                Contact the developers
              </a>
            </p>
          </div>
        {{/if}}
      {{/if}}
    {{/with}}

    {{! This will be shown if the data has finished loading but there's no
        job that matches the query. This would imply the job _id in the URL
        is invalid}}
    {{#unless getJob}}
      <div class="alert alert-danger" role="alert">
        <h4>Invalid URL</h4>
        <p>
          You seem to have entered an invalid URL.
        </p>
        <p>
          If you believe you are seeing this this message in error, please
          contact the developers.
        </p>
        <p>
          <a href="mailto:mokolodi1@gmail.com?Subject=Invalid%20URL"
              type="button" class="btn btn-primary">
            Contact the developers
          </a>
        </p>
      </div>
    {{/unless}}
  {{else}}
    <div class="alert alert-info" role="alert">
      <h4>Loading...</h4>
      <p>
        The data will arrive soon!
      </p>
    </div>
  {{/if}}
</template>

<template name="jobDoneResult">
  {{> rememberThisUrl}}


  <h3>Input</h3>

  <h4>Activated Kinases</h4>
  <div class="row">
    <div class="col-md-4 col-sm-8 col-xs-12">
      {{> listGenes kinases}}
    </div>
  </div>

  <h4>Mutations</h4>
  <div class="row">
    <div class="col-md-4 col-sm-8 col-xs-12">
      {{> listGenes mutations}}
    </div>
  </div>

  <h4>Copy Number Amplifications</h4>
  <div class="row">
    <div class="col-md-4 col-sm-8 col-xs-12">
      {{> listGenes amps}}
    </div>
  </div>

  <h4>Copy Number Deletions</h4>
  <div class="row">
    <div class="col-md-4 col-sm-8 col-xs-12">
      {{> listGenes dels}}
    </div>
  </div>

  <h4>Transcription Factors</h4>
  <div class="row">
    <div class="col-md-4 col-sm-8 col-xs-12">
      {{> listGenes tfs}}
    </div>
  </div>

  <h3>pCHIP</h3>
  {{> pChipResult this}}

  <h3>
    Network
    {{#if result.networkString}}
      <a href={{networkBlobUrl}} class="btn btn-primary" target="_blank">
        <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span>
        Download .sif
      </a>
    {{/if}}
  </h3>
  {{#if result.networkString}}
    {{> circleMapGraphTemplate this}}
  {{else}}
    <p>
      No network result.
    </p>
  {{/if}}
</template>

<template name="listGenes">
  {{#if length this}}
    <ul class="list-group">
      {{#each this}}
        <a href="http://www.genecards.org/cgi-bin/carddisp.pl?gene={{this}}"
            data-toggle="tooltip" title="View in GeneCards"
            class="list-group-item" target="_blank">
          {{this}}
        </a>
      {{/each}}
    </ul>
  {{else}}
    <p>
      None
    </p>
  {{/if}}
</template>

<template name="pChipResult">
  {{#with FS.GetFile "blobs" result.hallmarksBlobId}}
    <a href="{{this.url}}" target="_blank">
      <img src="{{this.url}}" alt="" style="width: 100%;">
    </a>
  {{/with}}
</template>

<template name="rememberThisUrl">
  {{#if remindToSaveUrl}}
    <div class="alert alert-warning alert-dismissible" role="alert"
        style="display: inline-block; margin-top: 25px;">
      <button id="dismissRemindSaveUrl" type="button" class="close"
          data-toggle="tooltip" title="Don't show again">
        <span aria-hidden="true">&times;</span>
      </button>
      <strong>Heads up!</strong>
      Be sure to save this page's URL if you'd like to access this result
      later.
    </div>
  {{/if}}
</template>
